<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TrekMate - Your Ultimate Hiking Companion</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <!-- Leaflet JS (Fix for L.map error) -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #F8F9FA;
        }
        .hero-bg {
            background-image: linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.5)), url('https://images.unsplash.com/photo-1551632811-561732d1e306?auto=format&fit=crop&w=1920&q=80');
            background-size: cover;
            background-position: center;
        }
        .card-hover-effect {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .card-hover-effect:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        /* Custom scrollbar for a better look */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        .modal {
            transition: opacity 0.3s ease-in-out;
        }
        #chat-output::-webkit-scrollbar-thumb {
            background: #4a5568;
        }
        #chat-output::-webkit-scrollbar-track {
            background: #2d3748;
        }
        /* Active nav link style */
        .nav-link-active {
            color: #16a34a; /* text-green-600 */
            font-weight: 600;
        }
        .tab-btn-active {
            background-color: #16a34a; /* bg-green-600 */
            color: white;
        }
        /* Leaflet Map z-index fix to stay below modals */
        .leaflet-pane {
            z-index: 0 !important; 
        }
        .leaflet-top, .leaflet-bottom {
            z-index: 0 !important;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <!-- Header -->
    <header id="header" class="bg-white/80 backdrop-blur-lg fixed top-0 left-0 right-0 z-50 transition-all duration-300 shadow-sm">
        <div class="container mx-auto px-6 py-4 flex justify-between items-center">
            <a href="#" class="text-2xl font-bold text-gray-800 flex items-center">
                <i data-lucide="mountain-snow" class="mr-2 text-green-600"></i>
                TrekMate
            </a>
            <nav id="desktop-nav" class="hidden md:flex space-x-8 items-center">
                <a href="#home" class="nav-link text-gray-600 hover:text-green-600 transition-colors">Home</a>
                <a href="#treks" class="nav-link text-gray-600 hover:text-green-600 transition-colors">Trek Info</a>
                <a href="#map-section" class="nav-link text-gray-600 hover:text-green-600 transition-colors">Trek Map</a>
                <a href="#ngo-area" class="nav-link text-gray-600 hover:text-green-600 transition-colors">NGO Area</a>
                <a href="#contact" class="nav-link text-gray-600 hover:text-green-600 transition-colors">Contact</a>
            </nav>
            <div class="flex items-center space-x-4">
                <button id="ai-assistant-btn" class="bg-green-600 text-white px-4 py-2 rounded-full hover:bg-green-700 transition-colors flex items-center shadow">
                    <i data-lucide="sparkles" class="mr-2 h-5 w-5"></i>
                    AI Assistant
                </button>
                <button id="mobile-menu-btn" class="md:hidden text-gray-800">
                    <i data-lucide="menu"></i>
                </button>
            </div>
        </div>
        <!-- Mobile Menu -->
        <div id="mobile-menu" class="hidden md:hidden px-6 pb-4">
            <a href="#home" class="nav-link-mobile block py-2 text-gray-600 hover:text-green-600">Home</a>
            <a href="#treks" class="nav-link-mobile block py-2 text-gray-600 hover:text-green-600">Trek Info</a>
            <a href="#map-section" class="nav-link-mobile block py-2 text-gray-600 hover:text-green-600">Trek Map</a>
            <a href="#ngo-area" class="nav-link-mobile block py-2 text-gray-600 hover:text-green-600">NGO Area</a>
            <a href="#contact" class="nav-link-mobile block py-2 text-gray-600 hover:text-green-600">Contact</a>
        </div>
    </header>

    <main>
        <!-- Hero Section -->
        <section id="home" class="hero-bg text-white min-h-screen flex items-center">
            <div class="container mx-auto px-6 text-center">
                <h1 class="text-4xl md:text-6xl font-bold mb-4 leading-tight">Your Adventure Awaits</h1>
                <p class="text-lg md:text-xl mb-8 max-w-3xl mx-auto">Navigate, stay safe, and connect with a community that shares your passion for the wild. TrekMate is your essential companion for every trail.</p>
                <a href="#treks" class="bg-green-600 text-white px-8 py-4 rounded-full text-lg font-semibold hover:bg-green-700 transition-transform transform hover:scale-105 shadow-lg">Start Your Adventure</a>
            </div>
        </section>

        <!-- NGO Area Section -->
        <section id="ngo-area" class="py-20 bg-gray-100">
            <div class="container mx-auto px-6">
                <div class="text-center mb-12">
                    <h2 class="text-3xl md:text-4xl font-bold text-gray-800">Community & Conservation Hub</h2>
                    <p class="text-gray-600 mt-4 max-w-3xl mx-auto">Connect with NGOs and fellow trekkers to protect our natural heritage. Report issues, find cleanup drives, and see the positive impact of our community.</p>
                </div>

                <!-- Tabs -->
                <div class="mb-8 flex justify-center border-b border-gray-300">
                    <button id="tab-trekker-reports" class="tab-btn py-3 px-6 text-lg font-semibold border-b-2 border-transparent hover:border-green-600 hover:text-green-600 transition">Trekker Reports & Issues</button>
                    <button id="tab-ngo-activities" class="tab-btn py-3 px-6 text-lg font-semibold border-b-2 border-transparent hover:border-green-600 hover:text-green-600 transition">NGO Activities & Updates</button>
                </div>

                <!-- Tab Content -->
                <div>
                    <!-- Trekker Reports Content -->
                    <div id="content-trekker-reports" class="tab-content">
                        <div class="grid lg:grid-cols-2 gap-12">
                            <!-- Left Column: Report Forms -->
                            <div class="space-y-12">
                                <!-- Report an Issue Form -->
                                <div class="bg-white p-8 rounded-lg shadow-md">
                                    <h3 class="text-2xl font-bold mb-6 text-center">Report a Trekking Issue</h3>
                                    <form id="issue-form">
                                        <div class="mb-4">
                                            <label for="issue-location" class="block text-sm font-medium text-gray-700">Trek/Fort Name</label>
                                            <input type="text" id="issue-location" required placeholder="e.g., Lohagad Fort" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500">
                                        </div>
                                        <div class="mb-4">
                                            <label for="issue-type" class="block text-sm font-medium text-gray-700">Type of Issue</label>
                                            <select id="issue-type" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500">
                                                <option>Missing Signboard</option>
                                                <option>Safety Concern (e.g., broken path)</option>
                                                <option>Difficult/Unclear Route</option>
                                                <option>Other</option>
                                            </select>
                                        </div>
                                        <div class="mb-4">
                                            <label for="issue-details" class="block text-sm font-medium text-gray-700">Details</label>
                                            <textarea id="issue-details" rows="4" required placeholder="Please provide a clear description of the problem." class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500"></textarea>
                                        </div>
                                        <button type="submit" class="w-full bg-green-600 text-white py-3 rounded-md font-semibold hover:bg-green-700 transition-colors">Submit Issue</button>
                                    </form>
                                </div>

                                <!-- Report Garbage Form -->
                                <div class="bg-white p-8 rounded-lg shadow-md">
                                    <h3 class="text-2xl font-bold mb-6 text-center">Report a Garbage Area</h3>
                                    <form id="garbage-form">
                                        <div class="mb-4">
                                            <label for="garbage-location" class="block text-sm font-medium text-gray-700">Trek/River/Fort Name</label>
                                            <input type="text" id="garbage-location" required placeholder="e.g., Visapur Fort Trail" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500">
                                        </div>
                                        <div class="mb-4">
                                            <label for="garbage-image" class="block text-sm font-medium text-gray-700">Photo URL (Optional)</label>
                                            <input type="url" id="garbage-image" placeholder="https://example.com/image.jpg" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500">
                                        </div>
                                        <div class="mb-4">
                                            <label for="garbage-details" class="block text-sm font-medium text-gray-700">Details</label>
                                            <textarea id="garbage-details" rows="4" required placeholder="Describe the location and type of garbage." class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500"></textarea>
                                        </div>
                                        <div class="mb-4">
                                            <button type="button" id="get-location-btn" class="w-full text-sm bg-blue-500 text-white py-2 rounded-md hover:bg-blue-600 flex items-center justify-center">
                                                <i data-lucide="map-pin" class="mr-2 h-4 w-4"></i> Get Current Location
                                            </button>
                                            <p id="location-feedback" class="text-xs text-center mt-1 text-gray-500"></p>
                                            <input type="hidden" id="garbage-lat">
                                            <input type="hidden" id="garbage-lon">
                                        </div>
                                        <button type="submit" class="w-full bg-red-500 text-white py-3 rounded-md font-semibold hover:bg-red-600 transition-colors">Report Garbage</button>
                                    </form>
                                </div>
                            </div>

                            <!-- Right Column: Display Reports -->
                            <div class="space-y-8">
                               <div>
                                    <h3 class="text-2xl font-bold mb-4 text-center">Recent Issues Reported</h3>
                                    <div id="issues-display" class="space-y-4 max-h-[600px] overflow-y-auto p-4 bg-white rounded-lg shadow-inner">
                                        <p class="text-gray-500 text-center">Loading issues...</p>
                                    </div>
                               </div>
                               <div>
                                    <h3 class="text-2xl font-bold mb-4 text-center">Recent Garbage Reports</h3>
                                    <div id="garbage-display" class="space-y-4 max-h-[600px] overflow-y-auto p-4 bg-white rounded-lg shadow-inner">
                                        <p class="text-gray-500 text-center">Loading reports...</p>
                                    </div>
                               </div>
                            </div>
                        </div>
                    </div>

                    <!-- NGO Activities Content -->
                    <div id="content-ngo-activities" class="tab-content hidden">
                        <div class="grid lg:grid-cols-2 gap-12">
                            <!-- Left Column: NGO Forms & AI Tools -->
                             <div class="space-y-12">
                                <!-- AI-Powered NGO Toolkit -->
                                <div class="bg-white p-8 rounded-lg shadow-md">
                                    <h3 class="text-2xl font-bold mb-6 text-center text-blue-600 flex items-center justify-center"><i data-lucide="cpu" class="mr-2"></i>AI-Powered NGO Toolkit</h3>
                                    
                                    <!-- AI Garbage Analyst -->
                                    <div class="mb-8">
                                        <h4 class="text-lg font-semibold mb-2">Garbage Report Analyst</h4>
                                        <p class="text-sm text-gray-600 mb-4">Enter a location to analyze all user-submitted garbage reports and get actionable insights for your next cleanup drive.</p>
                                        <div class="flex gap-2">
                                            <input type="text" id="garbage-analysis-location" placeholder="e.g., Lohagad Fort" class="flex-grow rounded-md border-gray-300 shadow-sm">
                                            <button id="analyze-garbage-btn" class="bg-blue-600 text-white px-4 py-2 rounded-md font-semibold hover:bg-blue-700 flex items-center justify-center">
                                                Analyze ✨
                                            </button>
                                        </div>
                                        <div id="garbage-analysis-output" class="mt-4 p-4 bg-gray-50 rounded-lg hidden prose max-w-none">
                                            <div id="garbage-analysis-loader" class="text-center hidden">
                                                <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600 mx-auto"></div>
                                            </div>
                                            <div id="garbage-analysis-content"></div>
                                        </div>
                                    </div>

                                    <!-- AI Content Generator -->
                                    <div>
                                        <h4 class="text-lg font-semibold mb-2">Awareness Content Generator</h4>
                                        <p class="text-sm text-gray-600 mb-4">Enter a topic to generate a short, engaging social media post to promote responsible trekking.</p>
                                        <div class="flex gap-2">
                                            <input type="text" id="awareness-topic" placeholder="e.g., Plastic waste on trails" class="flex-grow rounded-md border-gray-300 shadow-sm">
                                            <button id="generate-awareness-btn" class="bg-blue-600 text-white px-4 py-2 rounded-md font-semibold hover:bg-blue-700 flex items-center justify-center">
                                                Generate ✨
                                            </button>
                                        </div>
                                        <div id="awareness-output" class="mt-4 p-4 bg-gray-50 rounded-lg hidden prose max-w-none">
                                             <div id="awareness-loader" class="text-center hidden">
                                                <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600 mx-auto"></div>
                                            </div>
                                            <div id="awareness-content" class="whitespace-pre-wrap"></div>
                                        </div>
                                    </div>
                                </div>
                                <!-- Post an Activity Form -->
                                <div class="bg-white p-8 rounded-lg shadow-md">
                                    <h3 class="text-2xl font-bold mb-6 text-center">Post an Upcoming Activity</h3>
                                    <form id="ngo-activity-form">
                                        <div class="mb-4">
                                            <label for="ngo-name-activity" class="block text-sm font-medium text-gray-700">NGO Name</label>
                                            <input type="text" id="ngo-name-activity" required placeholder="Your NGO's Name" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500">
                                        </div>
                                        <div class="mb-4">
                                            <label for="ngo-activity-title" class="block text-sm font-medium text-gray-700">Activity Title</label>
                                            <input type="text" id="ngo-activity-title" required placeholder="e.g., Sinhagad Fort Cleanup Drive" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500">
                                        </div>
                                         <div class="mb-4">
                                            <label for="ngo-activity-date" class="block text-sm font-medium text-gray-700">Date of Activity</label>
                                            <input type="date" id="ngo-activity-date" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500">
                                        </div>
                                        <div class="mb-4">
                                            <label for="ngo-activity-details" class="block text-sm font-medium text-gray-700">Details</label>
                                            <textarea id="ngo-activity-details" rows="4" required placeholder="Describe the event, meeting point, timings, etc." class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500"></textarea>
                                        </div>
                                        <button type="submit" class="w-full bg-green-600 text-white py-3 rounded-md font-semibold hover:bg-green-700 transition-colors">Post Activity</button>
                                    </form>
                                </div>
                                <!-- Post a Work Report Form -->
                                 <div class="bg-white p-8 rounded-lg shadow-md">
                                    <h3 class="text-2xl font-bold mb-6 text-center">Share a Work Report</h3>
                                    <form id="ngo-report-form">
                                        <div class="mb-4">
                                            <label for="ngo-name-report" class="block text-sm font-medium text-gray-700">NGO Name</label>
                                            <input type="text" id="ngo-name-report" required placeholder="Your NGO's Name" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500">
                                        </div>
                                        <div class="mb-4">
                                            <label for="ngo-report-title" class="block text-sm font-medium text-gray-700">Report Title</label>
                                            <input type="text" id="ngo-report-title" required placeholder="e.g., Post-Monsoon Cleanup at Rajgad" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500">
                                        </div>
                                        <div class="mb-4">
                                            <label for="ngo-report-image" class="block text-sm font-medium text-gray-700">Photo URL</label>
                                            <input type="url" id="ngo-report-image" required placeholder="https://example.com/photo.jpg" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500">
                                        </div>
                                        <div class="mb-4">
                                            <label for="ngo-report-details" class="block text-sm font-medium text-gray-700">Work Details</label>
                                            <textarea id="ngo-report-details" rows="4" required placeholder="Summarize the work completed and the outcome." class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500"></textarea>
                                        </div>
                                        <button type="submit" class="w-full bg-blue-600 text-white py-3 rounded-md font-semibold hover:bg-blue-700 transition-colors">Share Report</button>
                                    </form>
                                </div>
                            </div>
                            <!-- Right Column: Display NGO Activities/Reports -->
                            <div class="space-y-8">
                               <div>
                                    <h3 class="text-2xl font-bold mb-4 text-center">Upcoming Activities</h3>
                                    <div id="ngo-activities-display" class="space-y-4 max-h-[600px] overflow-y-auto p-4 bg-white rounded-lg shadow-inner">
                                        <p class="text-gray-500 text-center">Loading activities...</p>
                                    </div>
                               </div>
                               <div>
                                    <h3 class="text-2xl font-bold mb-4 text-center">Completed Work Reports</h3>
                                    <div id="ngo-reports-display" class="space-y-4 max-h-[600px] overflow-y-auto p-4 bg-white rounded-lg shadow-inner">
                                        <p class="text-gray-500 text-center">Loading reports...</p>
                                    </div>
                               </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Features Section -->
        <section id="features" class="py-20 bg-white">
            <div class="container mx-auto px-6">
                <div class="text-center mb-12">
                    <h2 class="text-3xl md:text-4xl font-bold text-gray-800">Everything You Need for the Perfect Trek</h2>
                    <p class="text-gray-600 mt-4 max-w-2xl mx-auto">From cutting-edge safety features to a vibrant community, we've got you covered.</p>
                </div>
                <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
                     <!-- Feature Card -->
                    <div class="bg-gray-50 p-8 rounded-lg shadow-sm text-center card-hover-effect">
                        <div class="bg-green-100 text-green-600 rounded-full p-4 inline-block mb-4">
                            <i data-lucide="map-pinned"></i>
                        </div>
                        <h3 class="text-xl font-bold mb-2">Real-time GPS Tracking</h3>
                        <p class="text-gray-600">Share your journey with loved ones and never lose your way with our precise, live tracking.</p>
                    </div>
                    <!-- Feature Card -->
                    <div class="bg-gray-50 p-8 rounded-lg shadow-sm text-center card-hover-effect">
                        <div class="bg-red-100 text-red-600 rounded-full p-4 inline-block mb-4">
                            <i data-lucide="siren"></i>
                        </div>
                        <h3 class="text-xl font-bold mb-2">SOS Emergency Alerts</h3>
                        <p class="text-gray-600">Instantly notify emergency contacts with your exact location at the tap of a button.</p>
                    </div>
                    <!-- Feature Card -->
                    <div class="bg-gray-50 p-8 rounded-lg shadow-sm text-center card-hover-effect">
                        <div class="bg-green-100 text-green-600 rounded-full p-4 inline-block mb-4">
                            <i data-lucide="wifi-off"></i>
                        </div>
                        <h3 class="text-xl font-bold mb-2">Offline Map Access</h3>
                        <p class="text-gray-600">Download detailed maps before you go and navigate confidently, even without a signal.</p>
                    </div>
                    <!-- Feature Card -->
                    <div class="bg-gray-50 p-8 rounded-lg shadow-sm text-center card-hover-effect">
                        <div class="bg-green-100 text-green-600 rounded-full p-4 inline-block mb-4">
                            <i data-lucide="leaf"></i>
                        </div>
                        <h3 class="text-xl font-bold mb-2">Eco-Reporting</h3>
                        <p class="text-gray-600">Help protect our trails by reporting litter or environmental damage with a photo and GPS tag.</p>
                    </div>
                     <!-- Feature Card -->
                    <div class="bg-gray-50 p-8 rounded-lg shadow-sm text-center card-hover-effect">
                        <div class="bg-green-100 text-green-600 rounded-full p-4 inline-block mb-4">
                            <i data-lucide="book-marked"></i>
                        </div>
                        <h3 class="text-xl font-bold mb-2">Personal Trek Diary</h3>
                        <p class="text-gray-600">Log your adventures, save your favorite spots, and create a beautiful journal of your treks.</p>
                    </div>
                    <!-- Feature Card -->
                    <div class="bg-gray-50 p-8 rounded-lg shadow-sm text-center card-hover-effect">
                        <div class="bg-green-100 text-green-600 rounded-full p-4 inline-block mb-4">
                            <i data-lucide="users"></i>
                        </div>
                        <h3 class="text-xl font-bold mb-2">Thriving Community</h3>
                        <p class="text-gray-600">Share tips, photos, and reviews. Find trekking partners and join discussions in our forums.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- AI Safety Advisor Section -->
        <section id="ai-safety" class="py-20 bg-gray-100">
            <div class="container mx-auto px-6">
                <div class="text-center mb-12">
                    <h2 class="text-3xl md:text-4xl font-bold text-gray-800">AI-Powered Safety Advisor</h2>
                    <p class="text-gray-600 mt-4 max-w-2xl mx-auto">Enter a trek name or region to get personalized safety tips from our AI guide.</p>
                </div>
                <div class="max-w-4xl mx-auto bg-white p-8 rounded-lg shadow-md">
                    <div class="flex flex-col sm:flex-row gap-4">
                        <input type="text" id="safety-input" placeholder="e.g., Mount Kilimanjaro" class="flex-grow mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500 p-3">
                        <button id="get-safety-tips-btn" class="bg-blue-600 text-white px-8 py-3 rounded-full font-semibold hover:bg-blue-700 transition-transform transform hover:scale-105 shadow-lg flex items-center justify-center">
                            <i data-lucide="shield-check" class="mr-2"></i>
                            Get Safety Tips ✨
                        </button>
                    </div>
                    <div id="safety-tips-output" class="mt-8 p-6 bg-gray-50 rounded-lg hidden prose max-w-none">
                        <div id="safety-tips-loader" class="text-center hidden">
                            <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"></div>
                            <p class="mt-2 text-gray-600">Our AI is checking the trail conditions...</p>
                        </div>
                        <div id="safety-tips-content"></div>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- AI Packing Planner Section -->
        <section id="ai-planner" class="py-20 bg-white">
            <div class="container mx-auto px-6">
                <div class="text-center mb-12">
                    <h2 class="text-3xl md:text-4xl font-bold text-gray-800">AI-Powered Packing Planner</h2>
                    <p class="text-gray-600 mt-4 max-w-2xl mx-auto">Let our AI create a personalized packing list for your next adventure. Just fill in the details below!</p>
                </div>
                <div class="max-w-4xl mx-auto bg-white p-8 rounded-lg shadow-md">
                    <div class="grid md:grid-cols-2 gap-6">
                        <div>
                            <label for="planner-destination" class="block text-sm font-medium text-gray-700">Destination</label>
                            <input type="text" id="planner-destination" placeholder="e.g., Himalayas, Nepal" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500">
                        </div>
                        <div>
                            <label for="planner-duration" class="block text-sm font-medium text-gray-700">Duration (days)</label>
                            <input type="number" id="planner-duration" placeholder="e.g., 7" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500">
                        </div>
                        <div>
                            <label for="planner-season" class="block text-sm font-medium text-gray-700">Season</label>
                            <select id="planner-season" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500">
                                <option>Spring</option>
                                <option>Summer</option>
                                <option>Autumn</option>
                                <option>Winter</option>
                            </select>
                        </div>
                        <div>
                            <label for="planner-difficulty" class="block text-sm font-medium text-gray-700">Difficulty</label>
                            <select id="planner-difficulty" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500">
                                <option>Easy</option>
                                <option>Moderate</option>
                                <option>Challenging</option>
                                <option>Extreme</option>
                            </select>
                        </div>
                    </div>
                    <div class="mt-6 text-center">
                        <button id="generate-packing-list-btn" class="bg-green-600 text-white px-8 py-3 rounded-full font-semibold hover:bg-green-700 transition-transform transform hover:scale-105 shadow-lg flex items-center justify-center mx-auto">
                            <i data-lucide="list-checks" class="mr-2"></i>
                            Generate Packing List
                        </button>
                    </div>
                    <div id="packing-list-output" class="mt-8 p-6 bg-gray-50 rounded-lg hidden prose max-w-none">
                        <div id="packing-list-loader" class="text-center hidden">
                            <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-green-600 mx-auto"></div>
                            <p class="mt-2 text-gray-600">Our AI is packing your bags...</p>
                        </div>
                        <div id="packing-list-content"></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Upcoming Treks Section -->
        <section id="treks" class="py-20 bg-gray-100">
            <div class="container mx-auto px-6">
                <div class="text-center mb-12">
                    <h2 class="text-3xl md:text-4xl font-bold text-gray-800">Join an Upcoming Trek</h2>
                    <p class="text-gray-600 mt-4 max-w-2xl mx-auto">Explore breathtaking landscapes with our expert-led groups. Find your next great adventure here.</p>
                </div>
                <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
                    <!-- Trek Card 1 -->
                    <div class="bg-white rounded-lg shadow-sm overflow-hidden card-hover-effect">
                        <img src="https://placehold.co/600x400/34a853/ffffff?text=Everest+Base+Camp" alt="Everest Base Camp Trek" class="w-full h-56 object-cover">
                        <div class="p-6">
                            <h3 class="text-xl font-bold mb-2">Everest Base Camp</h3>
                            <p class="text-gray-600 mb-4 flex items-center"><i data-lucide="map-pin" class="mr-2 h-4 w-4"></i>Himalayas, Nepal</p>
                            <p class="text-gray-600 mb-4 flex items-center"><i data-lucide="calendar" class="mr-2 h-4 w-4"></i>Next Trek: Oct 15, 2025</p>
                            <div class="flex justify-between items-center">
                                <span class="text-2xl font-bold text-green-600">$1,800</span>
                                <a href="#contact" class="bg-green-600 text-white px-4 py-2 rounded-full hover:bg-green-700 transition-colors text-sm">Inquire Now</a>
                            </div>
                        </div>
                    </div>
                    <!-- Trek Card 2 -->
                    <div class="bg-white rounded-lg shadow-sm overflow-hidden card-hover-effect">
                        <img src="https://placehold.co/600x400/fbbc05/ffffff?text=Inca+Trail" alt="Inca Trail to Machu Picchu" class="w-full h-56 object-cover">
                        <div class="p-6">
                            <h3 class="text-xl font-bold mb-2">Inca Trail to Machu Picchu</h3>
                            <p class="text-gray-600 mb-4 flex items-center"><i data-lucide="map-pin" class="mr-2 h-4 w-4"></i>Andes, Peru</p>
                            <p class="text-gray-600 mb-4 flex items-center"><i data-lucide="calendar" class="mr-2 h-4 w-4"></i>Next Trek: Nov 05, 2025</p>
                            <div class="flex justify-between items-center">
                                <span class="text-2xl font-bold text-green-600">$2,200</span>
                                <a href="#contact" class="bg-green-600 text-white px-4 py-2 rounded-full hover:bg-green-700 transition-colors text-sm">Inquire Now</a>
                            </div>
                        </div>
                    </div>
                    <!-- Trek Card 3 -->
                    <div class="bg-white rounded-lg shadow-sm overflow-hidden card-hover-effect">
                        <img src="https://placehold.co/600x400/ea4335/ffffff?text=Mount+Kilimanjaro" alt="Mount Kilimanjaro" class="w-full h-56 object-cover">
                        <div class="p-6">
                            <h3 class="text-xl font-bold mb-2">Mount Kilimanjaro</h3>
                            <p class="text-gray-600 mb-4 flex items-center"><i data-lucide="map-pin" class="mr-2 h-4 w-4"></i>Tanzania, Africa</p>
                            <p class="text-gray-600 mb-4 flex items-center"><i data-lucide="calendar" class="mr-2 h-4 w-4"></i>Next Trek: Jan 20, 2026</p>
                            <div class="flex justify-between items-center">
                                <span class="text-2xl font-bold text-green-600">$3,500</span>
                                <a href="#contact" class="bg-green-600 text-white px-4 py-2 rounded-full hover:bg-green-700 transition-colors text-sm">Inquire Now</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Trek Map Section -->
        <section id="map-section" class="py-20 bg-white">
            <div class="container mx-auto px-6">
                <div class="text-center mb-12">
                    <h2 class="text-3xl md:text-4xl font-bold text-gray-800">Explore Our Trek Locations</h2>
                    <p class="text-gray-600 mt-4 max-w-2xl mx-auto">Visualize your next adventure on our interactive map showing all our trek starting points.</p>
                </div>
                <div class="bg-white rounded-lg shadow-lg overflow-hidden">
                    <div id="treks-map" style="height: 500px; width: 100%;"></div>
                </div>
            </div>
        </section>

        <!-- Contact Section -->
        <section id="contact" class="py-20 bg-gray-100">
            <div class="container mx-auto px-6 grid lg:grid-cols-2 gap-12 items-center">
                <div>
                    <h2 class="text-3xl font-bold mb-4">Get in Touch</h2>
                    <p class="text-gray-600 mb-8">Have a question or need help planning? We're here for you!</p>
                    <form id="contact-form">
                        <div class="mb-4">
                            <label for="contact-name" class="block text-sm font-medium text-gray-700">Name</label>
                            <input type="text" id="contact-name" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500">
                        </div>
                        <div class="mb-4">
                            <label for="contact-email" class="block text-sm font-medium text-gray-700">Email</label>
                            <input type="email" id="contact-email" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500">
                        </div>
                        <div class="mb-4">
                            <label for="contact-message" class="block text-sm font-medium text-gray-700">Message</label>
                            <textarea id="contact-message" rows="5" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500"></textarea>
                        </div>
                        <button type="submit" class="w-full bg-green-600 text-white py-3 rounded-md font-semibold hover:bg-green-700 transition-colors">Send Message</button>
                    </form>
                </div>
                <div class="bg-white rounded-lg shadow-lg overflow-hidden h-96 lg:h-full">
                     <div id="contact-map" style="height: 100%; width: 100%;"></div>
                </div>
            </div>
        </section>
    </main>

    <footer class="bg-gray-800 text-white">
        <div class="container mx-auto px-6 py-12">
            <div class="grid md:grid-cols-4 gap-8">
                <div>
                    <h3 class="text-lg font-bold mb-4">TrekMate</h3>
                    <p class="text-gray-400">Your companion for every trail.</p>
                </div>
                <div>
                    <h3 class="text-lg font-semibold mb-4">Quick Links</h3>
                    <ul>
                        <li class="mb-2"><a href="#home" class="hover:text-green-400">Home</a></li>
                        <li class="mb-2"><a href="#features" class="hover:text-green-400">Features</a></li>
                        <li class="mb-2"><a href="#treks" class="hover:text-green-400">Treks</a></li>
                        <li class="mb-2"><a href="#contact" class="hover:text-green-400">Contact</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-lg font-semibold mb-4">Support</h3>
                     <ul>
                        <li class="mb-2"><a href="#" class="hover:text-green-400">FAQs</a></li>
                        <li class="mb-2"><a href="#" class="hover:text-green-400">Help Center</a></li>
                        <li class="mb-2"><a href="#" class="hover:text-green-400">Privacy Policy</a></li>
                    </ul>
                </div>
                 <div>
                    <h3 class="text-lg font-semibold mb-4">Follow Us</h3>
                    <div class="flex space-x-4">
                        <a href="#" class="text-gray-400 hover:text-white"><i data-lucide="twitter"></i></a>
                        <a href="#" class="text-gray-400 hover:text-white"><i data-lucide="instagram"></i></a>
                        <a href="#" class="text-gray-400 hover:text-white"><i data-lucide="facebook"></i></a>
                    </div>
                </div>
            </div>
            <div class="mt-12 border-t border-gray-700 pt-8 text-center text-gray-500">
                <p>&copy; 2025 TrekMate. All rights reserved.</p>
            </div>
        </div>
    </footer>
    
    <!-- Floating SOS Button -->
    <button id="sos-btn" class="fixed bottom-5 right-5 bg-red-600 text-white rounded-full p-4 shadow-lg z-50 hover:bg-red-700 transition-transform transform hover:scale-110">
        <i data-lucide="siren" class="h-8 w-8"></i>
    </button>
    
    <!-- SOS Confirmation Modal -->
    <div id="sos-modal" class="modal fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 z-[60] opacity-0 pointer-events-none">
        <div id="sos-modal-content" class="bg-white rounded-lg shadow-2xl w-full max-w-md transform scale-95 transition-transform duration-300">
            <div class="p-6 text-center">
                <i data-lucide="alert-triangle" class="h-16 w-16 text-red-500 mx-auto mb-4"></i>
                <h3 class="text-xl font-bold text-gray-800 mb-2">Confirm Emergency Alert</h3>
                <p class="text-gray-600 mb-6">This will send an SMS with your current location to your emergency contact. Only use this in a genuine emergency.</p>
                <div id="sos-status" class="text-gray-600 mb-4 hidden"></div>
                <div class="flex justify-center space-x-4">
                    <button id="cancel-sos" class="bg-gray-200 text-gray-800 px-8 py-3 rounded-full hover:bg-gray-300 transition-colors">Cancel</button>
                    <button id="confirm-sos" class="bg-red-600 text-white px-8 py-3 rounded-full hover:bg-red-700 transition-colors flex items-center justify-center">
                        <span id="confirm-sos-text">Confirm & Send</span>
                        <div id="sos-loader" class="animate-spin rounded-full h-5 w-5 border-b-2 border-white ml-2 hidden"></div>
                    </button>
                </div>
            </div>
        </div>
    </div>


    <!-- AI Assistant Modal -->
    <div id="ai-modal" class="modal fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 z-50 opacity-0 pointer-events-none">
        <div id="ai-modal-content" class="bg-white rounded-lg shadow-2xl w-full max-w-lg max-h-[90vh] flex flex-col transform scale-95 transition-transform duration-300">
            <div class="p-4 border-b flex justify-between items-center">
                <h3 class="text-lg font-bold flex items-center"><i data-lucide="sparkles" class="mr-2 text-green-600"></i>AI Trek Guide</h3>
                <button id="close-ai-modal" class="text-gray-500 hover:text-gray-800">&times;</button>
            </div>
            <div id="chat-output" class="flex-grow p-4 overflow-y-auto bg-gray-100 space-y-4">
                <div class="flex justify-start">
                    <div class="bg-gray-200 text-gray-800 p-3 rounded-lg max-w-xs">
                        Hello! I'm your AI Trek Guide. Ask me anything about hiking, gear, safety, or famous trails!
                    </div>
                </div>
            </div>
            <div class="p-4 border-t">
                <div id="chat-loader" class="text-center mb-2 hidden">
                    <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-green-600 mx-auto"></div>
                </div>
                <div class="flex">
                    <input type="text" id="chat-input" placeholder="Ask about a trek..." class="flex-grow border rounded-l-md p-2 focus:outline-none focus:ring-2 focus:ring-green-500">
                    <button id="chat-send" class="bg-green-600 text-white px-4 rounded-r-md hover:bg-green-700">Send</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Notification Toast -->
    <div id="toast" class="fixed bottom-5 right-5 bg-gray-900 text-white px-6 py-3 rounded-lg shadow-lg opacity-0 translate-y-10 transition-all duration-300 z-[70]">
        <span id="toast-message"></span>
    </div>

    <script type="module">
        // --- CONFIGURATION ---
        const SUPABASE_URL = 'https://dwxikjpxkyotedewxgkr.supabase.co'; 
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImR3eGlranB4a3lvdGVkZXd4Z2tyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc3NzI2ODksImV4cCI6MjA3MzM0ODY4OX0.0ZVsX3yfiC-pWcmy8yuUXHQOzkTutNY18FVg7LPDSUI';
        const GEMINI_API_KEY = "AIzaSyCV95tkESypIYH37ln5Zd2c60bb4RNJjMM";
        /* IMPORTANT: GOOGLE MAPS API KEY
          To make the maps work, you MUST replace 'YOUR_GOOGLE_MAPS_API_KEY' below with your actual API key 
          from the Google Cloud Console. 
          Get a key here: https://console.cloud.google.com/google/maps-apis/
        */
        const GOOGLE_MAPS_API_KEY = 'YOUR_GOOGLE_MAPS_API_KEY';
        
        // --- SOS Alert Configuration ---
        const TWILIO_FUNCTION_URL = 'YOUR_TWILIO_FUNCTION_URL'; // IMPORTANT: Replace with your actual Twilio Function URL
        const EMERGENCY_CONTACT_NUMBER = 'YOUR_EMERGENCY_CONTACT_PHONE_NUMBER'; // IMPORTANT: Replace with the recipient's phone number (e.g., +15551234567)
        
        // --- INITIALIZATION ---
        lucide.createIcons();
        document.addEventListener('DOMContentLoaded', () => {
            loadGoogleMapsScript();
            loadNgoContent();
            setupTabs();
        });
        
        // --- Toast Notification ---
        const toast = document.getElementById('toast');
        const toastMessage = document.getElementById('toast-message');

        function showToast(message, isSuccess = true) {
            if (!toast || !toastMessage) return;
            toastMessage.textContent = message;
            toast.classList.toggle('bg-red-600', !isSuccess);
            toast.classList.toggle('bg-gray-900', isSuccess);
            toast.classList.remove('opacity-0', 'translate-y-10');
            setTimeout(() => {
                toast.classList.add('opacity-0', 'translate-y-10');
            }, 3000);
        }

        // --- NGO Area Tabs ---
        function setupTabs() {
            const trekkerTab = document.getElementById('tab-trekker-reports');
            const ngoTab = document.getElementById('tab-ngo-activities');
            const trekkerContent = document.getElementById('content-trekker-reports');
            const ngoContent = document.getElementById('content-ngo-activities');

            if (trekkerTab && ngoTab && trekkerContent && ngoContent) {
                trekkerTab.classList.add('tab-btn-active');

                trekkerTab.addEventListener('click', () => {
                    trekkerContent.classList.remove('hidden');
                    ngoContent.classList.add('hidden');
                    trekkerTab.classList.add('tab-btn-active');
                    ngoTab.classList.remove('tab-btn-active');
                });

                ngoTab.addEventListener('click', () => {
                    ngoContent.classList.remove('hidden');
                    trekkerContent.classList.add('hidden');
                    ngoTab.classList.add('tab-btn-active');
                    trekkerTab.classList.remove('tab-btn-active');
                });
            }
        }

        // --- Supabase & Dynamic Content ---
        async function fetchFromSupabase(tableName, options = {}) {
            if (!SUPABASE_URL || !SUPABASE_ANON_KEY) return null;
            let query = `select=*`;
            if (options.order) query += `&order=${options.order}`;
            if (options.limit) query += `&limit=${options.limit}`;
            if (options.filter) query += `&${options.filter}`;

            const response = await fetch(`${SUPABASE_URL}/rest/v1/${tableName}?${query}`, {
                headers: { 'apikey': SUPABASE_ANON_KEY, 'Authorization': `Bearer ${SUPABASE_ANON_KEY}` },
            });
            if (!response.ok) {
                return null; // Return null on failure
            }
            return response.json();
        }

        async function supabaseSubmit(tableName, data) {
             if (!SUPABASE_URL || !SUPABASE_ANON_KEY) {
                 console.error("Supabase URL or Key is not configured.");
                 showToast("Backend not configured.", false);
                 return;
            }
            const response = await fetch(`${SUPABASE_URL}/rest/v1/${tableName}`, {
                method: 'POST',
                headers: {
                    'apikey': SUPABASE_ANON_KEY,
                    'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
                    'Content-Type': 'application/json',
                    'Prefer': 'return=minimal',
                },
                body: JSON.stringify(data),
            });

            if (!response.ok) {
                const error = await response.json();
                console.error('Supabase Error:', error);
                throw new Error(`Supabase error: ${error.message}`);
            }
        }
        
        async function loadNgoContent() {
             const errorHtml = (tableName) => `
                <div class="p-4 bg-red-100 border-l-4 border-red-500 text-red-700 rounded-md">
                    <p class="font-bold">Database Error</p>
                    <p>Could not load content from the "${tableName}" table. This usually means the table hasn't been created in your Supabase project yet.</p>
                    <p class="mt-2 text-sm"><strong>Action Required:</strong> Please go to the SQL Editor in your Supabase project and run the provided setup script to create the necessary tables and permissions.</p>
                </div>
            `;

            const displayContent = async (containerId, tableName, renderFunction, emptyMessage) => {
                const display = document.getElementById(containerId);
                const data = await fetchFromSupabase(tableName);
                display.innerHTML = '';
                if (data === null) {
                    display.innerHTML = errorHtml(tableName);
                } else if (data.length > 0) {
                    data.forEach(item => renderFunction(display, item));
                } else {
                    display.innerHTML = `<p class="text-gray-500 text-center">${emptyMessage}</p>`;
                }
            };
            
            // Render Functions
            const renderIssue = (display, item) => {
                const card = document.createElement('div');
                card.className = 'p-4 border rounded-lg bg-gray-50';
                card.innerHTML = `<p class="font-bold">${item.location}</p><p class="text-sm text-red-600 font-semibold">${item.issue_type}</p><p class="mt-2 text-gray-700">${item.details}</p>`;
                display.appendChild(card);
            };
            const renderGarbage = (display, item) => {
                const card = document.createElement('div');
                card.className = 'p-4 border rounded-lg bg-gray-50';
                card.innerHTML = `<p class="font-bold">${item.location}</p>${item.image_url ? `<img src="${item.image_url}" alt="Garbage report" class="my-2 rounded-lg max-h-40 w-auto">` : ''}<p class="mt-2 text-gray-700">${item.details}</p>${item.latitude ? `<a href="https://maps.google.com/?q=${item.latitude},${item.longitude}" target="_blank" class="text-xs text-blue-500 hover:underline">View on Map</a>` : ''}`;
                display.appendChild(card);
            };
            const renderActivity = (display, item) => {
                const card = document.createElement('div');
                card.className = 'p-4 border rounded-lg bg-gray-50';
                card.innerHTML = `<p class="font-bold text-green-700">${item.title}</p><p class="text-sm font-semibold">${item.ngo_name}</p><p class="text-sm text-gray-600">Date: ${new Date(item.activity_date).toLocaleDateString()}</p><p class="mt-2 text-gray-700">${item.description}</p>`;
                display.appendChild(card);
            };
            const renderReport = (display, item) => {
                const card = document.createElement('div');
                card.className = 'p-4 border rounded-lg bg-gray-50';
                card.innerHTML = `<p class="font-bold text-blue-700">${item.title}</p><p class="text-sm font-semibold">${item.ngo_name}</p><img src="${item.image_url}" alt="Work report" class="my-2 rounded-lg"><p class="mt-2 text-gray-700">${item.description}</p>`;
                display.appendChild(card);
            };

            displayContent('issues-display', 'trek_issues', renderIssue, 'No issues reported yet.');
            displayContent('garbage-display', 'garbage_reports', renderGarbage, 'No garbage reports yet.');
            displayContent('ngo-activities-display', 'ngo_activities', renderActivity, 'No upcoming activities.');
            displayContent('ngo-reports-display', 'ngo_reports', renderReport, 'No work reports yet.');
        }
        
        // --- Form Submission Event Listeners ---

        document.getElementById('issue-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const form = e.target;
            try {
                await supabaseSubmit('trek_issues', { location: form['issue-location'].value, issue_type: form['issue-type'].value, details: form['issue-details'].value });
                showToast('Issue submitted successfully. Thank you!');
                form.reset();
                loadNgoContent();
            } catch (error) {
                showToast('Failed to submit issue.', false);
            }
        });

        document.getElementById('garbage-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const form = e.target;
            try {
                await supabaseSubmit('garbage_reports', { location: form['garbage-location'].value, image_url: form['garbage-image'].value, details: form['garbage-details'].value, latitude: form['garbage-lat'].value || null, longitude: form['garbage-lon'].value || null });
                showToast('Garbage report submitted. Thank you for your help!');
                form.reset();
                document.getElementById('location-feedback').textContent = '';
                loadNgoContent();
            } catch (error) {
                showToast('Failed to submit report.', false);
            }
        });
        
        document.getElementById('ngo-activity-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const form = e.target;
            try {
                await supabaseSubmit('ngo_activities', { ngo_name: form['ngo-name-activity'].value, title: form['ngo-activity-title'].value, activity_date: form['ngo-activity-date'].value, description: form['ngo-activity-details'].value });
                showToast('Activity posted successfully!');
                form.reset();
                loadNgoContent();
            } catch (error) {
                showToast('Failed to post activity.', false);
            }
        });

        document.getElementById('ngo-report-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const form = e.target;
            try {
                await supabaseSubmit('ngo_reports', { ngo_name: form['ngo-name-report'].value, title: form['ngo-report-title'].value, image_url: form['ngo-report-image'].value, description: form['ngo-report-details'].value });
                showToast('Work report shared successfully!');
                form.reset();
                loadNgoContent();
            } catch (error) {
                showToast('Failed to share report.', false);
            }
        });
        
        document.getElementById('get-location-btn').addEventListener('click', () => {
            const feedbackEl = document.getElementById('location-feedback');
            if (navigator.geolocation) {
                feedbackEl.textContent = "Fetching location...";
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        document.getElementById('garbage-lat').value = position.coords.latitude;
                        document.getElementById('garbage-lon').value = position.coords.longitude;
                        feedbackEl.textContent = "Location captured successfully!";
                        feedbackEl.style.color = 'green';
                    },
                    () => {
                        feedbackEl.textContent = "Unable to retrieve location. Please grant permission.";
                        feedbackEl.style.color = 'red';
                    }
                );
            } else {
                feedbackEl.textContent = "Geolocation is not supported by this browser.";
                feedbackEl.style.color = 'red';
            }
        });
        
        document.getElementById('contact-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const form = e.target;
            try {
                await supabaseSubmit('contacts', {
                    name: form['contact-name'].value,
                    email: form['contact-email'].value,
                    message: form['contact-message'].value,
                });
                showToast('Message sent successfully!');
                form.reset();
            } catch (error) {
                console.error('Contact form submission error:', error);
                showToast('Failed to send message.', false);
            }
        });

        // --- SOS Alert Feature ---
        const sosBtn = document.getElementById('sos-btn');
        const sosModal = document.getElementById('sos-modal');
        const sosModalContent = document.getElementById('sos-modal-content');
        const cancelSosBtn = document.getElementById('cancel-sos');
        const confirmSosBtn = document.getElementById('confirm-sos');
        const sosStatus = document.getElementById('sos-status');
        const sosLoader = document.getElementById('sos-loader');
        const confirmSosText = document.getElementById('confirm-sos-text');

        sosBtn.addEventListener('click', () => {
            sosModal.classList.remove('opacity-0', 'pointer-events-none');
            sosModalContent.classList.remove('scale-95');
        });

        function closeSosModal() {
            sosModal.classList.add('opacity-0', 'pointer-events-none');
            sosModalContent.classList.add('scale-95');
            // Reset modal state
            setTimeout(() => {
                sosStatus.classList.add('hidden');
                confirmSosBtn.disabled = false;
                sosLoader.classList.add('hidden');
                confirmSosText.textContent = 'Confirm & Send';
            }, 300); // Wait for transition
        }

        cancelSosBtn.addEventListener('click', closeSosModal);

        confirmSosBtn.addEventListener('click', () => {
            if (TWILIO_FUNCTION_URL === 'YOUR_TWILIO_FUNCTION_URL' || EMERGENCY_CONTACT_NUMBER === 'YOUR_EMERGENCY_CONTACT_PHONE_NUMBER') {
                sosStatus.textContent = 'SOS feature is not configured.';
                sosStatus.classList.remove('hidden');
                sosStatus.classList.add('text-red-500');
                return;
            }

            sosStatus.textContent = 'Getting your location...';
            sosStatus.classList.remove('hidden', 'text-red-500', 'text-green-500');
            confirmSosBtn.disabled = true;
            sosLoader.classList.remove('hidden');
            confirmSosText.textContent = 'Sending...';

            navigator.geolocation.getCurrentPosition(
                async (position) => {
                    const { latitude, longitude } = position.coords;
                    const mapsLink = `https://www.google.com/maps?q=${latitude},${longitude}`;
                    const message = `SOS from TrekMate user! Emergency alert. Last known location: Lat: ${latitude}, Long: ${longitude}. Map: ${mapsLink}`;

                    sosStatus.textContent = 'Location found. Sending alert...';
                    
                    try {
                        const response = await fetch(TWILIO_FUNCTION_URL, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ to: EMERGENCY_CONTACT_NUMBER, body: message }),
                        });

                        if (!response.ok) throw new Error('Network response was not ok.');
                        
                        const result = await response.json();

                        if (result.success) {
                            sosStatus.textContent = 'Emergency alert sent successfully!';
                            sosStatus.classList.add('text-green-500');
                            setTimeout(closeSosModal, 3000);
                        } else {
                            throw new Error(result.error || 'Unknown error from SMS service.');
                        }

                    } catch (error) {
                        console.error('SOS sending failed:', error);
                        sosStatus.textContent = `Error: Could not send alert. Please check your connection.`;
                        sosStatus.classList.add('text-red-500');
                        confirmSosBtn.disabled = false;
                        sosLoader.classList.add('hidden');
                        confirmSosText.textContent = 'Retry Sending';
                    }
                },
                (error) => {
                    console.error('Geolocation error:', error);
                    let errorMessage = 'Could not get your location.';
                    if (error.code === 1) errorMessage = 'Location access was denied.';
                    sosStatus.textContent = `Error: ${errorMessage}`;
                    sosStatus.classList.add('text-red-500');
                    confirmSosBtn.disabled = false;
                    sosLoader.classList.add('hidden');
                    confirmSosText.textContent = 'Retry Sending';
                },
                { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 }
            );
        });

        // --- AI & Gemini API Features ---
        async function callGeminiAPI(prompt, systemInstruction) {
            if (!GEMINI_API_KEY || !GEMINI_API_KEY.startsWith("AIza")) {
                console.error("Gemini API key is not valid.");
                return "Error: Gemini API key is not configured correctly.";
            }
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${GEMINI_API_KEY}`;
            const payload = { contents: [{ parts: [{ text: prompt }] }] };
            if (systemInstruction) {
                payload.systemInstruction = { parts: [{ text: systemInstruction }] };
            }
            try {
                const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                if (!response.ok) { throw new Error(`API call failed with status: ${response.status}`) }
                const result = await response.json();
                return result.candidates?.[0]?.content?.parts?.[0]?.text || "Sorry, I couldn't generate a response.";
            } catch (error) {
                console.error("Error calling Gemini API:", error);
                return `Sorry, an error occurred: ${error.message}`;
            }
        }

        // AI Safety Advisor
        const getSafetyTipsBtn = document.getElementById('get-safety-tips-btn');
        const safetyInput = document.getElementById('safety-input');
        const safetyTipsOutput = document.getElementById('safety-tips-output');
        const safetyTipsLoader = document.getElementById('safety-tips-loader');
        const safetyTipsContent = document.getElementById('safety-tips-content');

        getSafetyTipsBtn.addEventListener('click', async () => {
            const topic = safetyInput.value.trim();
            if (!topic) {
                showToast("Please enter a trek or location.", false);
                return;
            }

            safetyTipsOutput.classList.remove('hidden');
            safetyTipsLoader.classList.remove('hidden');
            safetyTipsContent.innerHTML = '';

            const prompt = `Act as an expert trekking safety advisor. Provide a concise, actionable list of the top 5-7 most important safety tips for a trek in or to the following location: "${topic}". The tips should be specific to the potential challenges of that region (e.g., altitude, weather, wildlife). Format the response as a markdown list.`;

            const tips = await callGeminiAPI(prompt);

            let htmlTips = tips
                .replace(/\*\*([^*]+)\*\*/g, '<strong>$1</strong>')
                .replace(/\* (.*)/g, '<li class="ml-4 mb-2">$1</li>')
                .replace(/\n/g, '');

            safetyTipsLoader.classList.add('hidden');
            safetyTipsContent.innerHTML = `<ul>${htmlTips}</ul>`;
        });
        
        // AI Packing List Generator
        const generatePackingListBtn = document.getElementById('generate-packing-list-btn');
        const packingListOutput = document.getElementById('packing-list-output');
        const packingListLoader = document.getElementById('packing-list-loader');
        const packingListContent = document.getElementById('packing-list-content');

        generatePackingListBtn.addEventListener('click', async () => {
            const destination = document.getElementById('planner-destination').value;
            const duration = document.getElementById('planner-duration').value;
            const season = document.getElementById('planner-season').value;
            const difficulty = document.getElementById('planner-difficulty').value;

            if (!destination || !duration) {
                showToast("Please provide a destination and duration.", false);
                return;
            }

            packingListOutput.classList.remove('hidden');
            packingListLoader.classList.remove('hidden');
            packingListContent.innerHTML = '';

            const prompt = `Create a detailed packing list for a trek with the following specifics. Use markdown formatting with headings for categories (e.g., ## Clothing, ## Gear, ## Documents).
            
            - **Destination:** ${destination}
            - **Duration:** ${duration} days
            - **Season:** ${season}
            - **Difficulty:** ${difficulty}
            
            Provide specific recommendations where appropriate.`;
            
            const list = await callGeminiAPI(prompt);
            
            let htmlList = list
                .replace(/## (.*)/g, '<h3 class="text-lg font-semibold mt-4">$1</h3>')
                .replace(/\* (.*)/g, '<li class="ml-4">$1</li>')
                .replace(/\n/g, '<br>');

            packingListLoader.classList.add('hidden');
            packingListContent.innerHTML = `<ul>${htmlList}</ul>`;
        });
        
        // AI Assistant Modal Logic
        const aiModal = document.getElementById('ai-modal');
        const aiModalContent = document.getElementById('ai-modal-content');
        document.getElementById('ai-assistant-btn').addEventListener('click', () => {
            aiModal.classList.remove('opacity-0', 'pointer-events-none');
            aiModalContent.classList.remove('scale-95');
        });
        document.getElementById('close-ai-modal').addEventListener('click', () => {
            aiModal.classList.add('opacity-0', 'pointer-events-none');
            aiModalContent.classList.add('scale-95');
        });
        // Chatbot submit logic
        const chatInput = document.getElementById('chat-input');
        const chatSendBtn = document.getElementById('chat-send');
        const chatOutput = document.getElementById('chat-output');
        const chatLoader = document.getElementById('chat-loader');
        async function handleChatSubmit() {
            const userMessage = chatInput.value.trim();
            if (!userMessage) return;
            chatOutput.innerHTML += `<div class="flex justify-end"><div class="bg-green-600 text-white p-3 rounded-lg max-w-xs">${userMessage}</div></div>`;
            chatInput.value = '';
            chatOutput.scrollTop = chatOutput.scrollHeight;
            chatLoader.classList.remove('hidden');
            const systemInstruction = "You are a friendly and knowledgeable trekking guide. Your sole purpose is to provide information related to trekking, hiking, camping, and outdoor adventures. Politely refuse to answer any questions that are not related to these topics.";
            const aiResponse = await callGeminiAPI(userMessage, systemInstruction);
            chatOutput.innerHTML += `<div class="flex justify-start"><div class="bg-gray-200 text-gray-800 p-3 rounded-lg max-w-xs">${aiResponse}</div></div>`;
            chatLoader.classList.add('hidden');
            chatOutput.scrollTop = chatOutput.scrollHeight;
        }
        chatSendBtn.addEventListener('click', handleChatSubmit);
        chatInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') handleChatSubmit(); });
        
        // --- UI Interactions & Navigation ---
        const header = document.getElementById('header');
        window.addEventListener('scroll', () => {
            // Header shrink effect
            if (window.scrollY > 50) {
                header.classList.add('py-2', 'shadow-md');
                header.classList.remove('py-4');
            } else {
                header.classList.remove('py-2', 'shadow-md');
                header.classList.add('py-4');
            }
            // Active nav link highlighting
            updateActiveNavLink();
        });

        const mobileMenuBtn = document.getElementById('mobile-menu-btn');
        const mobileMenu = document.getElementById('mobile-menu');
        mobileMenuBtn.addEventListener('click', () => {
            mobileMenu.classList.toggle('hidden');
        });
        
        document.querySelectorAll('.nav-link-mobile').forEach(link => {
            link.addEventListener('click', () => {
                mobileMenu.classList.add('hidden');
            });
        });
        
        function updateActiveNavLink() {
            const sections = document.querySelectorAll('main section');
            const navLinks = document.querySelectorAll('#desktop-nav .nav-link');
            
            let currentSectionId = '';
            sections.forEach(section => {
                const sectionTop = section.offsetTop;
                if (window.scrollY >= sectionTop - 100) { // 100px offset for header height
                    currentSectionId = section.getAttribute('id');
                }
            });

            navLinks.forEach(link => {
                link.classList.remove('nav-link-active');
                if (link.getAttribute('href') === `#${currentSectionId}`) {
                    link.classList.add('nav-link-active');
                }
            });
        }

        // --- Google Maps Initialization & Loading ---
        function initMaps() {
            if (typeof google === 'undefined' || typeof google.maps === 'undefined') {
                console.warn("Google Maps could not be initialized. A valid API key is required.");
                
                // Use Leaflet/OpenStreetMap fallback if Google Maps fails
                if (typeof L !== 'undefined') {
                     // Treks Map
                     const treksMap = L.map('treks-map').setView([20.5937, 78.9629], 5);
                     L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
                     }).addTo(treksMap);
                     
                     const trekLocations = [
                        { name: 'Roopkund Trek', lat: 30.2619, lng: 79.7325 },
                        { name: 'Chadar Trek', lat: 33.9353, lng: 77.2043 },
                        { name: 'Valley of Flowers', lat: 30.7280, lng: 79.6053 },
                        { name: 'Hampta Pass', lat: 32.2400, lng: 77.3500 },
                        { name: 'Kudremukh', lat: 13.2190, lng: 75.2545 },
                        { name: 'Sandakphu', lat: 27.1055, lng: 88.0016 },
                        { name: 'Rajmachi Fort', lat: 18.8292, lng: 73.4507 }
                     ];
                     
                     trekLocations.forEach(loc => {
                         L.marker([loc.lat, loc.lng]).addTo(treksMap)
                          .bindPopup(loc.name);
                     });

                     // Contact Map
                     const contactMap = L.map('contact-map').setView([18.6197, 73.7431], 13);
                     L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
                     }).addTo(contactMap);
                     L.marker([18.6197, 73.7431]).addTo(contactMap).bindPopup('TrekMate HQ').openPopup();
                     
                     return;
                }

                const errorMessage = `
                    <div class="h-full w-full flex items-center justify-center bg-yellow-50 p-4">
                        <div class="text-center text-yellow-800">
                            <h3 class="font-bold">Map Feature Disabled</h3>
                            <p>Please provide a valid Google Maps API Key in the script to display this map.</p>
                        </div>
                    </div>`;
                document.getElementById('treks-map').innerHTML = errorMessage;
                document.getElementById('contact-map').innerHTML = errorMessage;
                return;
            }

            // Updated to Indian Trekking Locations
            const trekLocations = [
                { name: 'Roopkund Trek', position: { lat: 30.2619, lng: 79.7325 }, description: 'Uttarakhand: Famous for the skeletal lake and high altitude.' },
                { name: 'Chadar Trek', position: { lat: 33.9353, lng: 77.2043 }, description: 'Ladakh: The frozen river trek on the Zanskar River.' },
                { name: 'Valley of Flowers', position: { lat: 30.7280, lng: 79.6053 }, description: 'Uttarakhand: A vibrant national park known for endemic alpine flowers.' },
                { name: 'Hampta Pass', position: { lat: 32.2400, lng: 77.3500 }, description: 'Himachal Pradesh: A dramatic crossover from Kullu to Spiti.' },
                { name: 'Kudremukh', position: { lat: 13.2190, lng: 75.2545 }, description: 'Karnataka: A scenic peak in the Western Ghats resembling a horse face.' },
                { name: 'Sandakphu', position: { lat: 27.1055, lng: 88.0016 }, description: 'West Bengal: The highest peak in the state, offering Everest views.' },
                { name: 'Rajmachi Fort', position: { lat: 18.8292, lng: 73.4507 }, description: 'Maharashtra: A historical fort trek in the Sahyadris.' }
            ];

            const bounds = new google.maps.LatLngBounds();
            const treksMap = new google.maps.Map(document.getElementById('treks-map'), {
                zoom: 5, // Zoomed out to see India
                center: { lat: 20.5937, lng: 78.9629 }, // Center of India
                mapTypeControl: false,
                streetViewControl: false,
            });

            const infoWindow = new google.maps.InfoWindow();
            trekLocations.forEach(trek => {
                const marker = new google.maps.Marker({
                    position: trek.position, map: treksMap, title: trek.name, animation: google.maps.Animation.DROP,
                });
                marker.addListener('click', () => {
                    infoWindow.setContent(`<strong>${trek.name}</strong><p>${trek.description}</p>`);
                    infoWindow.open(treksMap, marker);
                });
                bounds.extend(marker.getPosition());
            });
            treksMap.fitBounds(bounds);

            const contactLocation = { lat: 18.6197, lng: 73.7431 };
            const contactMap = new google.maps.Map(document.getElementById('contact-map'), {
                zoom: 14, center: contactLocation, mapTypeControl: false, streetViewControl: false, zoomControl: false,
            });
            new google.maps.Marker({ position: contactLocation, map: contactMap, title: 'TrekMate HQ' });
        }
        
        function loadGoogleMapsScript() {
            if (GOOGLE_MAPS_API_KEY === 'YOUR_GOOGLE_MAPS_API_KEY') {
                console.warn("Note: Google Maps API Key is a placeholder. The map feature will be disabled until a valid key is provided.");
                initMaps(); // Call to display the placeholder message in the map divs
                return;
            }
            const script = document.createElement('script');
            script.src = `https://maps.googleapis.com/maps/api/js?key=${GOOGLE_MAPS_API_KEY}&callback=initMaps`;
            script.async = true;
            script.defer = true;
            document.head.appendChild(script);
        }

        window.initMaps = initMaps; // Make it globally accessible for the callback
    </script>
</body>
</html>
